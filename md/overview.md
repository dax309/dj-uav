

## 背景

无人机自动化作业中的航线飞行功能至关重要。过去，航线文件格式不统一，导致跨设备和跨机型使用困难，也限制了用户的二次编辑和业务优化。为了解决这些问题，推动无人机行业自动化，大疆正式发布了航线文件格式标准——WPML。

---

## 什么是 WPML

WPML 是 **W**ay**P**oint **M**arkup **L**anguage 的缩写，即航线文件格式标准。它基于 KML（Keyhole Markup Language）进行扩展，所有 WPML 航线文件都以 “.kmz” 作为后缀，并遵循 KMZ 归档要求。WPML 具备以下优势：

* **开放**：WPML 的定义公开共享，使用标记语言描述路径，具备很强的可扩展性。开发者可以根据开放原则自由添加业务数据。
* **易读**：WPML 采用基础的 XML 标记语言和媒体文件格式来描述航线，用户和开发者无需依赖特定解析软件即可读写文件内容。
* **继承**：WPML 将持续迭代并保持代际兼容性，确保航线文件在不同设备和机型之间能够直接应用和传承，成为真正的数字资产。

---

## 如何使用 WPML

WPML 航线文件实际上是使用 ZIP 格式打包的归档文件。解压后，一个标准的 WPML 文件包含以下结构：

* **`template.kml`**：被称为“模板文件”，用于定义业务属性，方便用户进行快速编辑和规划。例如，测绘用户只需定义测绘区域和重叠率，软件即可自动生成具体的飞行路径。
* **`waylines.wpml`**：被称为“执行文件”，包含了无人机具体的飞行和负载动作指令。这些指令由 DJI Pilot 2、DJI Flighthub 2 或其他软件根据 `template.kml` 的参数和算法生成。
* **`res`**：资源文件夹，用于存放航线所需的辅助资源，例如用于精准复拍的参考照片。

**注意：** 航线文件内部的文件或文件夹命名必须遵循此规范，否则可能导致读取失败。航线名称即航线文件的文件名，例如 `new_waypoints.kmz` 的航线名称是 `new_waypoints`。

---

## 已有航线转换

您可以通过以下几种方式将已有航线文件转换为 WPML 格式：

1.  **使用 Pilot 2 转换**：对于旧的 M300 RTK 航线文件（KML 格式），可以导入新版 DJI Pilot 2 并重新保存，即可升级为 WPML 格式。
2.  **使用航线库转换**：在 DJI MSDK 中，可以通过航线管理教程进行转换。需要注意的是，转换时需要提供已有航线的高度模式。
3.  **自定义转换**：如果您有自定义航线数据，需要注意不同坐标系下的高程转换。
    * **飞行器执行高度**：飞行器支持 **WGS84 椭球高**。在 `waylines.wpml` 文件中，`wpml:executeHeightMode` 字段需设置为 `WGS84`，`wpml:executeHeight` 字段需填入对应的椭球高。如果您的数据来自其他坐标系（如 EGM96），则需要先将其转换为 WGS84。
    * **编辑器编辑高度**：司空 2/Pilot 2 编辑器支持 **EGM96 海拔高**。在 `template.kml` 文件中，`wpml:heightMode` 字段需设置为 `EGM96`，`wpml:height` 字段需填入对应的海拔高。同样，如果您的数据来自其他坐标系（如 WGS84），则需要进行高程转换。

目前，大疆尚未开放航线格式转换库。如有需要，建议开发者基于 DJI Pilot 2 进行转换，或根据 WPML 航线文件格式标准自行生成。

---

希望以上信息能帮助您更好地理解和使用 WPML。如果您对 WPML 的特定字段或转换细节有更多疑问，可以参考文档中提供的链接。