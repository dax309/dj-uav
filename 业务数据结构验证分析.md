# 业务数据结构与实体类映射验证分析

## 1. 业务数据结构字段汇总

### 1.1 UavRouteReq（航线请求数据）
- `routeName` (String) - 航线名称
- `routeType` (String) - 航线类型
- `uavType` (String) - 无人机类型
- `uavSubType` (String) - 无人机子类型
- `payloadType` (String) - 负载类型
- `payloadSubType` (String) - 负载子类型
- `routeAction` (String) - 航线动作
- `globalHeight` (Double) - 全局高度
- `globalSpeed` (Double) - 全局速度
- `globalHeadingAngle` (Double) - 全局偏航角
- `globalTurnMode` (String) - 全局转弯模式
- `gimbalMode` (String) - 云台模式
- `takeOffSecurityHeight` (Double) - 起飞安全高度
- `maxFlightHeight` (Double) - 最大飞行高度
- `rcLostAction` (String) - 遥控器失联动作
- `outOfControlAction` (String) - 失控动作
- `takeOffRefPoint` (List<Double>) - 参考起飞点
- `routePoints` (List<RoutePointReq>) - 航点列表
- `mappingType` (MappingTypeReq) - 建图航拍参数
- `initActions` (List<PointActionReq>) - 初始动作列表

### 1.2 RoutePointReq（航点请求数据）
- `routePointIndex` (Integer) - 航点编号
- `longitude` (Double) - 经度
- `latitude` (Double) - latitude
- `height` (Double) - 高度
- `speed` (Double) - 速度
- `headingAngle` (Double) - 偏航角
- `turnMode` (String) - 转弯模式
- `gimbalPitchAngle` (Double) - 云台俯仰角
- `actions` (List<PointActionReq>) - 动作列表
- `shootPhotoTimeInterval` (Double) - 等时拍照间隔
- `shootPhotoDistanceInterval` (Double) - 等距拍照间隔
- `stopShootPhotoIndex` (Integer) - 停止间隔拍照航点编号

### 1.3 PointActionReq（航点动作请求数据）
- `actionIndex` (Integer) - 动作编号
- `hoverTime` (Double) - 悬停等待时间
- `aircraftHeading` (Double) - 飞行器目标偏航角
- `shootPhotoMode` (String) - 拍照类型
- `useGlobalShootPhotoMode` (Boolean) - 是否使用全局拍照模式
- `shootPhotoType` (String) - 拍照模式
- `gimbalYawAngle` (Double) - 云台偏航角
- `gimbalPitchAngle` (Double) - 云台俯仰角
- `zoomFocalLength` (Double) - 变焦焦距
- `startRecord` (Boolean) - 开始录像
- `stopRecord` (Boolean) - 停止录像

### 1.4 WaypointHeadingReq（航点偏航角请求数据）
- `waypointHeadingMode` (String) - 偏航角模式
- `waypointHeadingAngle` (Double) - 偏航角度
- `waypointPoiPoint` (List<Double>) - 兴趣点

### 1.5 WaypointTurnReq（航点转弯请求数据）
- `waypointTurnMode` (String) - 航点转弯模式
- `waypointTurnDampingDist` (Double) - 航点转弯截距
- `useStraightLine` (Boolean) - 该航段是否贴合直线

### 1.6 MappingTypeReq（建图航拍请求数据）
- `collectionMethod` (String) - 采集方式
- `lensType` (String) - 镜头类型
- `overlapH` (Integer) - 航向重叠率
- `overlapW` (Integer) - 旁向重叠率
- `elevationOptimizeEnable` (Integer) - 是否开启高程优化
- `shootType` (String) - 拍照模式
- `direction` (String) - 航线方向
- `margin` (String) - 测区外扩距离
- `coordinates` (List<CoordinatePointReq>) - 测区多边形坐标

### 1.7 CoordinatePointReq（坐标点请求数据）
- `longitude` (Double) - 经度
- `latitude` (Double) - 纬度
- `height` (Double) - 高度

## 2. 现有实体类字段汇总

### 2.1 UavRoute（航线实体）
- `id` (Long) - 主键ID
- `route_name` (String) - 航线名称
- `route_type` (String) - 航线类型
- `uav_type` (String) - 无人机类型
- `uav_sub_type` (String) - 无人机子类型
- `payload_type` (String) - 负载类型
- `payload_sub_type` (String) - 负载子类型
- `route_action` (String) - 航线动作
- `global_height` (BigDecimal) - 全局高度
- `global_speed` (BigDecimal) - 全局速度
- `global_heading_angle` (BigDecimal) - 全局偏航角
- `global_turn_mode` (String) - 全局转弯模式
- `gimbal_mode` (String) - 云台模式
- `take_off_security_height` (BigDecimal) - 起飞安全高度
- `max_flight_height` (BigDecimal) - 最大飞行高度
- `rc_lost_action` (String) - 遥控器失联动作
- `out_of_control_action` (String) - 失控动作
- `take_off_ref_point` (String/JSONB) - 参考起飞点
- `mapping_config` (String/JSONB) - 建图航拍配置
- `init_actions` (String/JSONB) - 初始动作配置
- `created_at` (LocalDateTime) - 创建时间
- `updated_at` (LocalDateTime) - 更新时间
- `is_deleted` (Boolean) - 软删除标记
- `version` (Integer) - 乐观锁版本号

### 2.2 UavWaypoint（航点实体）
- `id` (Long) - 主键ID
- `route_id` (Long) - 航线ID（外键）
- `waypoint_index` (Integer) - 航点序号
- `longitude` (BigDecimal) - 经度
- `latitude` (BigDecimal) - 纬度
- `height` (BigDecimal) - 高度
- `speed` (BigDecimal) - 速度
- `heading_angle` (BigDecimal) - 偏航角
- `turn_mode` (String) - 转弯模式
- `gimbal_pitch_angle` (BigDecimal) - 云台俯仰角
- `shoot_photo_time_interval` (BigDecimal) - 等时拍照间隔
- `shoot_photo_distance_interval` (BigDecimal) - 等距拍照间隔
- `stop_shoot_photo_index` (Integer) - 停止间隔拍照航点编号
- `waypoint_heading_config` (String/JSONB) - 航点偏航角配置
- `waypoint_turn_config` (String/JSONB) - 航点转弯配置
- `created_at` (LocalDateTime) - 创建时间
- `updated_at` (LocalDateTime) - 更新时间
- `is_deleted` (Boolean) - 软删除标记
- `version` (Integer) - 乐观锁版本号

### 2.3 UavWaypointAction（航点动作实体）
- `id` (Long) - 主键ID
- `waypoint_id` (Long) - 航点ID（外键）
- `action_index` (Integer) - 动作序号
- `hover_time` (BigDecimal) - 悬停等待时间
- `aircraft_heading` (BigDecimal) - 飞行器目标偏航角
- `shoot_photo_mode` (String) - 拍照类型
- `use_global_shoot_photo_mode` (Boolean) - 是否使用全局拍照模式
- `shoot_photo_type` (String) - 拍照模式
- `gimbal_yaw_angle` (BigDecimal) - 云台偏航角
- `gimbal_pitch_angle` (BigDecimal) - 云台俯仰角
- `zoom_focal_length` (BigDecimal) - 变焦焦距
- `start_record` (Boolean) - 开始录像
- `stop_record` (Boolean) - 停止录像
- `created_at` (LocalDateTime) - 创建时间
- `updated_at` (LocalDateTime) - 更新时间
- `is_deleted` (Boolean) - 软删除标记
- `version` (Integer) - 乐观锁版本号

### 2.4 CoordinatePoint（坐标点实体）
- `id` (Long) - 主键ID
- `route_id` (Long) - 航线ID（外键）
- `point_type` (String) - 点类型
- `point_index` (Integer) - 点序号
- `longitude` (BigDecimal) - 经度
- `latitude` (BigDecimal) - 纬度
- `height` (BigDecimal) - 高度
- `created_at` (LocalDateTime) - 创建时间
- `updated_at` (LocalDateTime) - 更新时间
- `is_deleted` (Boolean) - 软删除标记

### 2.5 RouteFile（航线文件实体）
- `id` (Long) - 主键ID
- `route_id` (Long) - 航线ID（外键）
- `file_name` (String) - 文件名
- `file_path` (String) - 文件路径
- `file_size` (Long) - 文件大小
- `file_type` (String) - 文件类型
- `file_hash` (String) - 文件哈希
- `mime_type` (String) - MIME类型
- `created_at` (LocalDateTime) - 创建时间
- `updated_at` (LocalDateTime) - 更新时间
- `is_deleted` (Boolean) - 软删除标记

## 3. 字段映射分析

### 3.1 UavRouteReq → UavRoute 映射分析

✅ **完全匹配的字段：**
- `routeName` → `route_name`
- `routeType` → `route_type`
- `uavType` → `uav_type`
- `uavSubType` → `uav_sub_type`
- `payloadType` → `payload_type`
- `payloadSubType` → `payload_sub_type`
- `routeAction` → `route_action`
- `globalHeight` → `global_height`
- `globalSpeed` → `global_speed`
- `globalHeadingAngle` → `global_heading_angle`
- `globalTurnMode` → `global_turn_mode`
- `gimbalMode` → `gimbal_mode`
- `takeOffSecurityHeight` → `take_off_security_height`
- `maxFlightHeight` → `max_flight_height`
- `rcLostAction` → `rc_lost_action`
- `outOfControlAction` → `out_of_control_action`
- `takeOffRefPoint` → `take_off_ref_point` (JSONB)
- `mappingType` → `mapping_config` (JSONB)
- `initActions` → `init_actions` (JSONB)

❌ **缺失的字段：**
- `routePoints` - 航点列表（通过UavWaypoint表关联存储）

### 3.2 RoutePointReq → UavWaypoint 映射分析

✅ **完全匹配的字段：**
- `routePointIndex` → `waypoint_index`
- `longitude` → `longitude`
- `latitude` → `latitude`
- `height` → `height`
- `speed` → `speed`
- `headingAngle` → `heading_angle`
- `turnMode` → `turn_mode`
- `gimbalPitchAngle` → `gimbal_pitch_angle`
- `shootPhotoTimeInterval` → `shoot_photo_time_interval`
- `shootPhotoDistanceInterval` → `shoot_photo_distance_interval`
- `stopShootPhotoIndex` → `stop_shoot_photo_index`

❌ **缺失的字段：**
- `actions` - 动作列表（通过UavWaypointAction表关联存储）

🔄 **JSONB字段映射：**
- WaypointHeadingReq数据 → `waypoint_heading_config` (JSONB)
- WaypointTurnReq数据 → `waypoint_turn_config` (JSONB)

### 3.3 PointActionReq → UavWaypointAction 映射分析

✅ **完全匹配的字段：**
- `actionIndex` → `action_index`
- `hoverTime` → `hover_time`
- `aircraftHeading` → `aircraft_heading`
- `shootPhotoMode` → `shoot_photo_mode`
- `useGlobalShootPhotoMode` → `use_global_shoot_photo_mode`
- `shootPhotoType` → `shoot_photo_type`
- `gimbalYawAngle` → `gimbal_yaw_angle`
- `gimbalPitchAngle` → `gimbal_pitch_angle`
- `zoomFocalLength` → `zoom_focal_length`
- `startRecord` → `start_record`
- `stopRecord` → `stop_record`

### 3.4 CoordinatePointReq → CoordinatePoint 映射分析

✅ **完全匹配的字段：**
- `longitude` → `longitude`
- `latitude` → `latitude`
- `height` → `height`

➕ **实体类额外字段：**
- `point_type` - 点类型（用于区分不同用途的坐标点）
- `point_index` - 点序号（用于排序）

## 4. 字段类型匹配分析

### 4.1 数值类型匹配
✅ **正确匹配：**
- 业务请求中的 `Double` → 实体类中的 `BigDecimal`
- 业务请求中的 `Integer` → 实体类中的 `Integer`
- 业务请求中的 `Boolean` → 实体类中的 `Boolean`

### 4.2 字符串类型匹配
✅ **正确匹配：**
- 业务请求中的 `String` → 实体类中的 `String`

### 4.3 复杂类型匹配
✅ **正确匹配：**
- 业务请求中的 `List<Double>` → 实体类中的 `String/JSONB`
- 业务请求中的 `MappingTypeReq` → 实体类中的 `String/JSONB`
- 业务请求中的 `List<PointActionReq>` → 实体类中的 `String/JSONB`
- 业务请求中的 `WaypointHeadingReq` → 实体类中的 `String/JSONB`
- 业务请求中的 `WaypointTurnReq` → 实体类中的 `String/JSONB`

## 5. 缺失字段分析

### 5.1 关键缺失字段
❌ **无缺失关键字段** - 所有业务字段都有对应的存储方案

### 5.2 存储方案说明
- **航点列表** (`routePoints`): 通过 `UavWaypoint` 表的 `route_id` 外键关联存储
- **动作列表** (`actions`): 通过 `UavWaypointAction` 表的 `waypoint_id` 外键关联存储
- **复杂对象**: 通过JSONB字段存储，保持数据完整性

## 6. 冗余字段分析

### 6.1 实体类冗余字段
➕ **合理的额外字段：**
- `id` - 主键，数据库必需
- `created_at`, `updated_at` - 审计字段，业务必需
- `is_deleted` - 软删除标记，业务必需
- `version` - 乐观锁，并发控制必需
- `route_id`, `waypoint_id` - 外键，关联关系必需
- `point_type`, `point_index` - 坐标点分类和排序，业务扩展必需

❌ **无冗余字段** - 所有额外字段都有明确的业务用途

## 7. JSONB字段使用合理性分析

### 7.1 合理使用的JSONB字段
✅ **take_off_ref_point** (List<Double>)
- 原因：起飞参考点坐标，结构简单且相对固定
- 优势：避免额外表结构，查询效率高

✅ **mapping_config** (MappingTypeReq)
- 原因：建图航拍配置，包含多个相关参数
- 优势：保持配置完整性，便于整体操作

✅ **init_actions** (List<PointActionReq>)
- 原因：初始动作列表，与航点动作结构相同但用途不同
- 优势：避免表结构复杂化，便于批量操作

✅ **waypoint_heading_config** (WaypointHeadingReq)
- 原因：航点偏航角配置，参数相对固定
- 优势：避免额外字段，保持表结构简洁

✅ **waypoint_turn_config** (WaypointTurnReq)
- 原因：航点转弯配置，参数相对固定
- 优势：避免额外字段，保持表结构简洁

### 7.2 JSONB使用策略
- **简单列表数据**: 使用JSONB存储（如坐标点列表）
- **配置类数据**: 使用JSONB存储（如建图配置）
- **核心业务数据**: 使用独立表存储（如航点、动作）
- **关联关系数据**: 使用外键关联（如航线-航点-动作）

## 8. 验证结论

### 8.1 整体评估
✅ **数据完整性**: 所有业务字段都有对应的存储方案，无数据丢失风险
✅ **类型匹配性**: 字段类型映射正确，Double→BigDecimal提供更高精度
✅ **存储效率**: JSONB字段使用合理，平衡了存储效率和查询性能
✅ **扩展性**: 表结构设计支持业务扩展，预留了必要的元数据字段
✅ **关联完整性**: 外键关系设计合理，支持复杂的业务关联查询

### 8.2 设计优势
1. **分层存储**: 核心数据独立表存储，配置数据JSONB存储
2. **类型安全**: 使用BigDecimal确保数值精度
3. **审计完整**: 包含完整的审计字段
4. **并发安全**: 乐观锁机制防止并发冲突
5. **软删除**: 支持数据恢复和历史追踪

### 8.3 建议
1. **索引优化**: 为常用查询字段添加索引
2. **约束完善**: 添加必要的检查约束
3. **文档完善**: 补充JSONB字段的结构文档
4. **性能监控**: 监控JSONB字段的查询性能

## 9. 最终结论

**✅ 现有实体类和数据库表结构完全满足buildKmz和parseKmz方法的业务数据存储需求**

- **无缺失字段**: 所有业务数据都有对应的存储方案
- **无冗余字段**: 所有实体字段都有明确的业务用途
- **类型匹配**: 字段类型映射正确且安全
- **设计合理**: 存储策略平衡了性能、完整性和扩展性
- **架构清晰**: 分层存储策略支持复杂业务场景

**建议**: 当前设计已经满足业务需求，可以直接用于生产环境。